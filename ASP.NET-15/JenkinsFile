properties([disableConcurrentBuilds()])

pipeline {
    agent {
         label 'ubuntu'    
         }             
    options {
        buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))
        timestamps()
    }
    stages {
       stage("delete old docker for new") {
            steps {
                echo " ============== delete old version  =================="
                dir ('ASP.NET-15/Shop-15') {
                sh ' sudo docker stop shoptest'
                sh 'sudo docker rm shoptest'    
            }
            }
            }            
       stage("integration") {    
            steps {
                echo "================ Start building images for integration========="
                dir ('ASP.NET-15/Shop-15') {
                sh 'sudo docker pull nazarserver/shoptest '
                sh 'sudo docker run -d --restart=always -p 80:80 --name market nazarserver/shoptest'
             }
             }  
             }
    }
  }
